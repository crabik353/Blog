<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ—Å—Ç: {{ post.title }}</title>
</head>
<body>
<h1>{{ post.title }}</h1>
<h3>{{ post.theme }}</h3>
<p><strong>–ê–≤—Ç–æ—Ä:</strong> {{ post.username }}</p>
<p>{{ post.content }}</p>
{% if post.image_url %}
<img src="{{ post.image_url }}" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ" style="max-width: 300px;">
{% endif %}
<p><strong>–°–æ–∑–¥–∞–Ω:</strong> {{ post.created_at }}</p>
<p><strong>–¢–µ–≥–∏:</strong> {{ post.tags|join(", ") }}</p>
<form action="/posts/{{ post.id }}/like" method="POST">
    <button type="submit">üëç {{ post.likes|length }}</button>
</form>
<form action="/posts/{{ post.id }}/dislike" method="POST">
    <button type="submit">üëé {{ post.dislikes|length }}</button>
</form>
<form id="comment-form-{{ post.id }}" onsubmit="addComment(event, {{ post.id }})">
    <input type="text" name="text" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..." required>
    <button type="submit">–ö–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
</form>
<ul>
    {% for comment in comments %}
    {% if comment.post_id == post.id %}
    <li>
        <strong>{{ users[comment.user_id] }}:</strong> {{ comment.text }}
        <p><small>–°–æ–∑–¥–∞–Ω: {{ comment.created_at }}</small></p>
        {% if username and users[comment.user_id] == username %}
        <form action="/comments/{{ comment.id }}/delete" method="POST" style="display:inline;">
            <button type="submit">–£–¥–∞–ª–∏—Ç—å</button>
        </form>
        {% endif %}
    </li>
    {% endif %}
    {% endfor %}
</ul>
{% if username and post.username == username %}
<a href="/posts/{{ post.id }}/edit">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
<form action="/posts/{{ post.id }}/delete" method="POST" style="display:inline;">
    <button type="submit">–£–¥–∞–ª–∏—Ç—å</button>
</form>
{% endif %}
<a href="/posts">–ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É –ø–æ—Å—Ç–æ–≤</a>

<script>
    function addComment(event, postId) {
        event.preventDefault();
        const form = event.target;
        const text = form.querySelector('input[name="text"]').value;

        fetch(`/posts/${postId}/comment`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: `text=${encodeURIComponent(text)}`
        }).then(response => response.json())
          .then(data => {
              if (data.message) {
                  location.reload(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
              } else {
                  alert(data.error);
              }
          });
    }
</script>
</body>
</html>